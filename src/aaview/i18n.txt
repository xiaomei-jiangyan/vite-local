我负责的 i18n 工具链包含三个脚本：
一个从源码自动提取并替换文本到 i18n 调用（i18nExact），
一个把本地语言 JSON 扁平化导出成 Excel 供翻译（i18nExport），
还有一个把翻译表导入并合并回语言文件的交互式工具（i18nImport）。
这些脚本保证了翻译流程可自动化、安全回写并支持人工校验。

我用 AST（Vue compiler + Babel）做源码层面的文本提取与替换，
结合 Prettier 做规范化，并在写回前做二次解析验证（输出 .bad.vue 做人工检查），
这样兼顾了自动化效率与源码安全；
在导出/导入环节我做了扁平化/差异检测与交互确认，形成一条可审计的 i18n 流水线

通过脚本将手工本地化工作量下降 X%（示例：把 500+ 文本提取自动化，人工翻译量只需维护 Excel）。
写回保护：曾捕获 N 个潜在破坏性替换（写进 .bad.vue），避免了直接覆盖源码的风险。
流程自动化后，翻译回写流程从数小时缩短到分钟级（具体可举内部案例或估算）。

Q：为什么要用 AST，而不是正则？
A：正则无法安全处理嵌套标签、属性引号和 JS 模板字符串，AST 能精确定位节点并避免误替换
正则对结构化语言非常脆弱，遇到嵌套标签、属性、注释、模板字符串或转义会误匹配或漏匹配；
AST 能定位到具体节点（文本节点、属性节点、字符串字面量、模板字面量），安全且语义明确


Q：你如何保证对 .vue 文件的替换不会破坏组件（例如丢失 script setup 或产生额外的 <template>）
A：把替换过程分为：解析（SFCParse）→ AST 修改 / 生成替换片段 → Prettier 格式化 → 二次解析校验
在写回前用 SFCParse 再解析一次，若解析失败则不覆盖原文件，而是把结果写到 .bad.vue 供人工审查（防止破坏源码）
保留原 script/scriptSetup 的 attrs（lang、setup、src），并在生成新的 script 时把这些属性写回，避免语义丢失z

Q：模板属性（比如 title="你好"）替换成绑定（:title="$t('key')"）有哪些坑？你怎么处理？
A：接字符串替换容易误替换部分文本；还要保证原属性不是动态表达式或必须保留为字符串（
如某些第三方组件要求字面量）
基于 AST 遍历到属性节点，判断是否为静态文本（Literal），仅在 safe 情况下生成绑定属性；
生成绑定属性时要把原属性替换为 :attr 并把值构造成 i18n 表达式

Q： script 内的字符串替换（apply-scripts）如何保证语义安全
A：仅在确定的、语义安全的位置做替换（比如简单字符串字面量作为函数参数、返回值或赋值表达式）——用 Babel AST 判断上下文。
对复杂表达式或模板字面量，把字符串抽象为 i18n key 并替换为 i18n 调用
（如 i18n.global.t('key', { _0: expr })），把表达式部分作为参数传递

Q： key 生成策略你是如何设计的？如何避免冲突且可维护？
A：基于文件相对路径 + 文件名 + 顺序编号（例如 pages.home.3）
或基于语义可读的 key（例如 components.header.title）
记录 indexMap（本实现有 zhPool.indexMap），
对同一文件使用递增计数；在团队环境里可以用内容指纹（hash）或上下文+hash 混合策略确保稳定

Q：你如何处理模板里的占位变量（例如 你好 ${name}）
A：把模板字符串提取为带占位的 i18n 模板，例如 你好 {name}，并把表达式部分作为参数传入：i18n.t('key', { name })
在生成 key 时保存模板和占位顺序，使导出给译者时可看到占位位置。
实现上把 TemplateLiteral 的 quasis 和 expressions 分离，构造 i18n 字符串与参数对象

Q： i18nImport / i18nExport 的流程中如何保证不会误写或丢失翻译？是否有备份/回滚设计？
A：导出时做扁平化导出，并报告缺失项，便于人工补全；导入时做差异对比（added/changed/deleted）并以交互方式确认是否写回

Q：：当项目很大时，如何优化/加速扫描与替换？
A：并行化解析但限制并发数（避免占满 CPU/内存），使用工作池。
缓存 AST 或已处理文件的 hash，只有内容变化才重做

Q：你做过哪些错误/回滚的例子
A：曾因字符串替换逻辑导致 SFC 结构破坏（Unexpected closing tag），改进为二次解析检查并输出 .bad.vue，
加入 dry-run 和备份。说明问题根因、修复动作与防护措施

Q：如何保证脚本不会破坏源码？ 
A：使用 Prettier + 二次 SFCParse 验证，并在失败时写 .bad.vue，不覆盖源文件；

Q：性能上有问题吗？
A：单机文件操作，规模常见项目能很快完成；若语言文件非常大可并行化或流式写入。

Q：export为什么扁平化？
A：便于表格化对齐（Excel）和翻译者逐行处理；在写回时再把 key 恢复为嵌套结构。

Q：如何处理冲突或格式错误的 Excel？
A：脚本里检查 header，生成 diff 列表；实务上先要求翻译模板严格遵守格式，或在脚本中增加更严格的校验/回退。

Q:如何保证 key 生成规则稳定且不冲突？
A: 使用文件路径 + 文件名 + 递增序号，或改为基于内容哈希/上下文的可读 key）

Q: 如何处理动态文本（拼接、模板变量）？
A：（把文本替换为带占位的 i18n 模板，并把表达式作为 params）

Q：如果翻译量大且要并行处理如何扩展？（
A：把扫描任务并行化、使用缓存避免二次解析、生成增量 patch 而非全量替换）

Q：你在简历里写了“基于项目出海背景，设计并实现国际化 i18n 自动化流水线”，能具体说一下项目的业务背景吗？
A：我所在项目是一个面向海外市场的移动/Web 应用，主要用户分布在日本。
为了扩展应用市场，需要支撑多语言版本，需要将界面文案、消息提示、通知等内容国际化。
因此我设计了一套自动化 i18n 流水线，实现文案提取、自动翻译、和导出全流程自动化，提升了出海迭代效率。

Q：可以具体说说你是怎么设计这个自动化流水线的吗？主要流程有哪些？
A：文案提取：通过 Node 脚本解析代码和模板，将需要翻译的日文文案提取出来，生成标准化 JSON。
翻译处理：调用 Google Translate API和百度翻译降级人都是批量翻译，支持多语言，
同时保留占位符（如 {_0}、{name}）。
###校验与格式化：对翻译结果进行占位符校验、HTML 标签处理和空格换行规范化，保证前端直接可用。
导出：生成多语言 JSON 和 Excel 文件，供前端按需加载。
导入: 校验新增、删除、更新，让开发者二次确定导入

Q：流水线中如何保证翻译质量？比如占位符、动态文案、模板字符串怎么办？
A：对占位符，我使用正则统一解析模板，如 {_0}，翻译时不被替换，保证前端渲染正确。
对动态文案，我把可变部分抽象为占位符，翻译内容只处理固定文本，同时，生成 Excel 供翻译人员人工复核，提高质量。

Q：你为什么选择 Node 脚本 + API，而不是现成的 i18n 工具？如何在 CI/CD 集成？
A：我们选择 Node 脚本是为了灵活定制：可以解析项目特定模板语法，
处理占位符和特殊格式。同时可以支持批量翻译和多项目复用。

Q：大规模文案如何高效处理？
A： 对大规模文案，我采用批量请求翻译 API，减少请求次数；
JSON 文件按模块拆分，前端按需加载，减小包体积。流水线脚本模块化设计，支持多项目共享，保证处理速度和可维护性。

Q：上线后，流水线给团队带来了哪些价值？
A：支持快速出海和多语言迭代。同时占位符校验和格式化保证了前端显示一致性，提高用户体验。

Q：你们流水线有处理国际化日期、货币或数字格式吗？前端如何正确显示不同地区的格式？
A：文案中涉及日期、时间或金额时，我们不直接翻译，而是保留占位符，前端根据用户 locale 使用国际化 API 处理。
例如：{amount} 通过 Intl.NumberFormat(locale, { style: 'currency', currency }) 显示货币；{date} 通过 Intl.DateTimeFormat(locale) 显示日期。
流水线的作用是保证文案可插值，前端负责格式化，实现高度可复用的多语言文案。

Q：如果翻译 API 调用失败或超时，流水线怎么保证稳定性？
A: 对每批文案调用翻译 API，如果失败会自动重试 1 次。
超过最大重试仍失败，会把失败文案记录到日志和 Excel，供人工处理。
流水线整体不会中断，保证其他文案正常处理。
这样既保证了自动化，又兼顾了异常可追踪性。

Q：如果文案量非常大（几万条），流水线如何高效处理？
A: 批量 API 调用：一次请求处理几十条文案，减少网络开销。
并发控制：控制同时翻译的任务数量，避免 API 限流或本地资源占满。
模块化 JSON：按功能模块拆分 JSON 文件，前端按需加载，减少打包体积。
缓存机制：相同文案只翻译一次，避免重复调用 API。

Q: 如果你们有多个项目共用同一套文案，流水线如何复用？
A: 流水线设计成 模块化 + 配置化：
核心逻辑（文案提取、占位符保护、翻译调用、校验、导出）是独立模块。
每个项目只需提供配置文件（代码路径、语言列表、输出路径），即可复用流水线。

Q:最终这个流水线对业务出海有什么具体价值？
A: 支持快速迭代和多语言发布，明显加快出海产品上线速度。翻译效率提升约 5-10 倍
 可复用设计降低维护成本，支持未来更多市场拓展。