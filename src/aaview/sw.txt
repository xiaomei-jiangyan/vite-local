å¤šæ ‡ç­¾é¡µåŒæ—¶æ‰“å¼€ï¼Œä¼šå¯¹åŒä¸€ä¸ªç¦»çº¿é˜Ÿåˆ—å†™å…¥æˆ–åŒæ­¥ï¼Œå¦‚ä½•é¿å…å†²çªæˆ–é‡å¤æäº¤ï¼Ÿ
Service Worker æ˜¯å…±äº«çº¿ç¨‹
å¤šä¸ªé¡µé¢éƒ½æ³¨å†ŒåŒä¸€ä¸ª SWï¼ŒSW åœ¨æµè§ˆå™¨é‡Œåªæœ‰ä¸€ä»½çº¿ç¨‹
fetch / sync äº‹ä»¶éƒ½æ˜¯åœ¨ SW çº¿ç¨‹é‡Œè§¦å‘
IndexedDB çš„å¹¶å‘è®¿é—®
IndexedDB æ”¯æŒå¤šä¸Šä¸‹æ–‡è¯»å†™
ä½†äº‹åŠ¡æ˜¯ç‹¬ç«‹çš„ â†’ ä¸¤ä¸ªæ ‡ç­¾é¡µåŒæ—¶å†™å¯èƒ½é¡ºåºä¸ç¡®å®š
Background Sync è§¦å‘å¯èƒ½é‡å¤
å¦‚æžœå¤šä¸ªæ ‡ç­¾é¡µæ³¨å†Œ sync â†’ å¯èƒ½é‡å¤é‡æ”¾åŒä¸€æ¡è¯·æ±‚

åˆ©ç”¨ Service Worker çš„å•çº¿ç¨‹ç‰¹æ€§ï¼Œåœ¨ replay é˜¶æ®µè®¾ç½®é”ï¼Œä¿è¯åŒä¸€æ—¶åˆ»åªæ‰§è¡Œä¸€æ¬¡é‡æ”¾ï¼›
IndexedDB å†™æ“ä½œä½¿ç”¨äº‹åŠ¡ï¼Œå¹¶åœ¨å†™å…¥æ—¶ç”Ÿæˆå”¯ä¸€æ ‡è¯†ï¼Œä¿è¯ä¸åŒæ ‡ç­¾é¡µå†™å…¥ä¸ä¼šå†²çªï¼›
replay é˜¶æ®µé€šè¿‡å”¯ä¸€ ID åŽ»é‡ï¼Œé¿å…é‡å¤æäº¤è¯·æ±‚ã€‚


å‡è®¾ç”¨æˆ·åœ¨å¼±ç½‘çŽ¯å¢ƒä¸‹ä½¿ç”¨ä½ çš„ PWAï¼Œæ¯åˆ†é’Ÿä¼šå‘èµ· 50 ä¸ª POST è¯·æ±‚ï¼ˆæ¯”å¦‚èŠå¤©æˆ–è¡¨å•æäº¤ï¼‰ï¼Œä½ ä»¬çš„ IndexedDB ç¦»çº¿é˜Ÿåˆ—å¯èƒ½ä¼šéžå¸¸å¤§?
UI é˜²æŠ– + åŽ»é‡ï¼šå¯¹é‡å¤è¯·æ±‚åœ¨ UI å±‚åšé˜²æŠ–ï¼Œé¿å…å†™å…¥ç¦»çº¿é˜Ÿåˆ—ï¼ŒåŒæ—¶æç¤ºç”¨æˆ·é¿å…é‡å¤æ“ä½œã€‚
é˜Ÿåˆ—å®¹é‡æŽ§åˆ¶ï¼šIndexedDB ç¦»çº¿é˜Ÿåˆ—è®¾ç½®æœ€å¤§æ¡æ•°ï¼ˆä¾‹å¦‚ 100 æ¡ï¼‰ï¼Œè¶…è¿‡é˜ˆå€¼å¯æŒ‰ FIFO ä¸¢å¼ƒæœ€æ—§è¯·æ±‚ï¼Œé˜²æ­¢è†¨èƒ€ã€‚
æ‰¹é‡é‡æ”¾ & å»¶è¿Ÿç­–ç•¥ï¼šç½‘ç»œæ¢å¤æ—¶å°†é˜Ÿåˆ—è¯·æ±‚åˆ†æ‰¹ï¼ˆå¦‚æ¯æ¬¡ 5â€“10 æ¡ï¼‰æäº¤ï¼Œé¿å…ä¸€æ¬¡æ€§å‘ 50 æ¡è¯·æ±‚é€ æˆé˜»å¡žæˆ–æ‹¥å¡žã€‚
å”¯ä¸€ ID & åŽ»é‡ï¼šæ¯æ¡è¯·æ±‚ç”Ÿæˆ UUIDï¼Œé‡æ”¾æ—¶æ£€æŸ¥å·²æäº¤çš„ IDï¼Œä¿è¯æœ€ç»ˆä¸€è‡´æ€§ã€‚
å¤±è´¥é‡è¯•ç­–ç•¥ï¼šå•æ¡è¯·æ±‚é‡è¯•æ¬¡æ•°æœ‰é™ï¼Œé¿å…æ— é™é‡è¯•ï¼ŒåŒæ—¶è®°å½•å¤±è´¥çŠ¶æ€ç»™ç”¨æˆ·ã€‚


å‡è®¾ç”¨æˆ·åœ¨ç¦»çº¿çŠ¶æ€ä¸‹æäº¤äº†å¾ˆå¤š POST è¯·æ±‚ï¼Œç„¶åŽï¼š
å…³é—­äº†æµè§ˆå™¨æ ‡ç­¾é¡µ
æˆ–è€…åˆ·æ–°é¡µé¢
æˆ–è€…æ‰“å¼€äº†æ–°æ ‡ç­¾é¡µ
ä½ å¦‚ä½•ä¿è¯ç¦»çº¿é˜Ÿåˆ—çš„æ•°æ®ä¸ä¼šä¸¢å¤±ï¼Œå¹¶ä¸”åœ¨ç½‘ç»œæ¢å¤åŽèƒ½å¤Ÿå¯é é‡æ”¾ï¼Ÿ
æŒä¹…åŒ–åˆ° IndexedDBï¼šæ¯æ¡ç¦»çº¿è¯·æ±‚å†™å…¥ DB å¹¶ç”Ÿæˆå”¯ä¸€ IDï¼Œç¡®ä¿æ•°æ®æŒä¹…æ€§ã€‚
Service Worker Background Syncï¼šç½‘ç»œæ¢å¤æ—¶ï¼ŒSW ä¼šè§¦å‘ sync ç”Ÿå‘½å‘¨æœŸäº‹ä»¶ï¼Œè¯»å–é˜Ÿåˆ—é‡æ”¾è¯·æ±‚ã€‚
æ‰¹é‡æäº¤ä¸ŽåŽ»é‡ï¼šé‡æ”¾è¯·æ±‚æ—¶åˆ†æ‰¹å¤„ç†ï¼Œå¹¶é€šè¿‡å”¯ä¸€ ID é¿å…å¤šæ ‡ç­¾é¡µé‡å¤æäº¤ã€‚
é”æœºåˆ¶æˆ–æ ‡è®°ï¼šåœ¨é‡æ”¾æœŸé—´è®¾ç½®æ‰§è¡Œé”ï¼Œç¡®ä¿åŒä¸€æ¡è¯·æ±‚ä¸ä¼šè¢«å¤šæ¬¡è§¦å‘ã€‚
ç”¨æˆ·æç¤ºä¸Žæœ€ç»ˆä¸€è‡´æ€§ï¼šå¤±è´¥è¯·æ±‚è®°å½•çŠ¶æ€å¹¶æç¤ºç”¨æˆ·ï¼Œä¿è¯æ•°æ®å¯æŽ§å’Œå¯é ã€‚



å‡è®¾ä½ çš„ PWA ç”¨æˆ·åœ¨å¼±ç½‘çŽ¯å¢ƒä¸‹ï¼š
æ‰“å¼€é¡µé¢åŽä¼šåŒæ—¶å‘èµ·å‡ åä¸ª GET æŽ¥å£è¯·æ±‚ + å›¾ç‰‡èµ„æºè¯·æ±‚
ç”¨æˆ·åœ¨ç¦»çº¿æƒ…å†µä¸‹åˆæäº¤äº†å¤§é‡ POST è¯·æ±‚
é¡µé¢è¢«å¤šæ ‡ç­¾é¡µæ‰“å¼€
è¯·é—®ä½ å¦‚ä½•è®¾è®¡ï¼š
é™æ€èµ„æºä¸ŽæŽ¥å£è¯·æ±‚çš„ç¼“å­˜ç­–ç•¥
POST ç¦»çº¿é˜Ÿåˆ—çš„å¤„ç†
é«˜å¹¶å‘åœºæ™¯ä¸‹çš„æ€§èƒ½ä¼˜åŒ–
ä¿è¯æ•°æ®æœ€ç»ˆä¸€è‡´æ€§å’Œç”¨æˆ·ä½“éªŒ?
é™æ€èµ„æºç¼“å­˜ç­–ç•¥
å›¾ç‰‡ã€JSã€CSS ç­‰é™æ€èµ„æºé‡‡ç”¨ Cache First ç­–ç•¥ï¼Œä¿è¯é¦–å±å¿«é€ŸåŠ è½½ï¼›
API è¯·æ±‚é‡‡ç”¨ Network First + Cache fallback ç­–ç•¥ï¼Œç¡®ä¿æ•°æ®å®žæ—¶æ€§å’Œç¦»çº¿å¯ç”¨ã€‚
POST ç¦»çº¿é˜Ÿåˆ—
æ‰€æœ‰ç¦»çº¿è¯·æ±‚å†™å…¥ IndexedDB é˜Ÿåˆ—ï¼Œç”Ÿæˆå”¯ä¸€ ID ä»¥é¿å…é‡å¤ï¼›
é˜Ÿåˆ—å®¹é‡é™åˆ¶ï¼ˆå¦‚ 100 æ¡ï¼‰é˜²æ­¢è†¨èƒ€ï¼›
é‡è¿žæ—¶é€šè¿‡ Background Sync æ‰¹é‡é‡æ”¾ï¼Œå¹¶è®¾ç½®é”æœºåˆ¶ï¼Œä¿è¯åŒä¸€æ¡è¯·æ±‚ä¸ä¼šé‡å¤æäº¤ã€‚
é«˜å¹¶å‘ä¼˜åŒ–
æ‰¹é‡æäº¤è¯·æ±‚ï¼ˆä¾‹å¦‚æ¯æ‰¹ 5â€“10 æ¡ï¼‰é™ä½Žç½‘ç»œåŽ‹åŠ›ï¼›
UI å±‚é˜²æŠ–ä¸Žæç¤ºï¼Œé¿å…é‡å¤æ“ä½œå’Œç”¨æˆ·å›°æƒ‘ã€‚
æœ€ç»ˆä¸€è‡´æ€§å’Œç”¨æˆ·ä½“éªŒ
å¯¹å¤±è´¥è¯·æ±‚æœ‰é™é‡è¯•ï¼ˆå¦‚ 3 æ¬¡ï¼‰ï¼Œè¶…è¿‡æ¬¡æ•°ä¸¢å¼ƒå¹¶æç¤ºç”¨æˆ·ï¼›
ç¡®ä¿ç¦»çº¿æœŸé—´æ“ä½œå¯æŽ§ï¼Œç½‘ç»œæ¢å¤åŽæ•°æ®å®Œæ•´åŒæ­¥ã€‚



æž„å»ºå·¥å…·ï¼ˆå¦‚ Vite/Workboxï¼‰ä¼šç”Ÿæˆ manifest.jsonï¼ˆè®°å½•æž„å»ºåŽçš„æ–‡ä»¶æ˜ å°„å…³ç³»ï¼‰ï¼Œè®°å½•å…¥å£æ–‡ä»¶ä¸Žå…¶ä¾èµ–å…³ç³»ã€‚
Workbox æ ¹æ® manifest è‡ªåŠ¨è¯†åˆ«æ ¸å¿ƒæ–‡ä»¶ï¼ˆindex.htmlã€å…¥å£ JSã€é¦–å± CSSã€vendor åº“ï¼‰ï¼Œåœ¨ SW å®‰è£…é˜¶æ®µ precacheï¼Œä¿è¯ç¦»çº¿é¦–å±å¯ç”¨ï¼ŒåŒæ—¶æ”¯æŒ hash æ›´æ–°è‡ªåŠ¨åˆ·æ–°ç¼“å­˜ã€‚

é—®ï¼šä»€ä¹ˆæ˜¯ PWAï¼Ÿä¸»è¦ä¾èµ–å“ªäº›æ ¸å¿ƒæŠ€æœ¯ï¼Ÿ
ç­”ï¼š
PWAï¼ˆProgressive Web Appï¼‰æ˜¯æ¸è¿›å¼ Web åº”ç”¨ï¼Œé€šè¿‡ Service Workerã€Web App Manifest å’Œ HTTPSï¼Œä½¿ Web åº”ç”¨å…·å¤‡ç¦»çº¿å¯ç”¨ã€å¯å®‰è£…å’ŒæŽ¥è¿‘åŽŸç”Ÿä½“éªŒã€‚
åœ¨æˆ‘ä»¬çš„ H5 Hybrid é¡¹ç›®ä¸­ï¼Œæˆ‘åˆ©ç”¨ Vite + Workbox æž„å»ºäº†ç¦»çº¿å¯ç”¨æ–¹æ¡ˆï¼Œä¿è¯å¼±ç½‘å’Œæ–­ç½‘æƒ…å†µä¸‹ä»å¯è®¿é—®æ ¸å¿ƒé¡µé¢ã€‚


é—®ï¼šService Worker å¦‚ä½•å®žçŽ°ç¦»çº¿è®¿é—®ï¼Ÿ
ç­”ï¼š
install é˜¶æ®µï¼šé¢„ç¼“å­˜é™æ€èµ„æºåˆ° Cache Storage
fetch é˜¶æ®µï¼šæ‹¦æˆªè¯·æ±‚
  é™æ€èµ„æº â†’ Cache First
  API è¯·æ±‚ â†’ Network First + fallback
ç¦»çº¿æƒ…å†µä¸‹ï¼Œæµè§ˆå™¨æ ¹æ®ç¼“å­˜ç­–ç•¥è¿”å›žèµ„æºï¼Œä¿è¯é¡µé¢å¯ç”¨ã€‚
é—®ï¼šSW ä¼šæ‹¦æˆªæ‰€æœ‰è¯·æ±‚å—ï¼Ÿ
ç­”ï¼š
SW åªæ‹¦æˆªåŒæºä¸” scope å†…çš„ fetch è¯·æ±‚ï¼ŒWebSocketã€è·¨åŸŸéž CORS è¯·æ±‚æˆ–éž HTTPS çŽ¯å¢ƒæ— æ³•æ‹¦æˆªã€‚


é—®ï¼šruntimeCaching å’Œ precache æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ
ç­”ï¼š
precacheï¼šbuild æ—¶å›ºå®šèµ„æºç¼“å­˜ï¼Œç”Ÿæˆ hashï¼Œä¿è¯ç‰ˆæœ¬ç®¡ç†
runtimeCachingï¼šè¿è¡Œæ—¶åŠ¨æ€è¯·æ±‚ç¼“å­˜ï¼Œç­–ç•¥çµæ´»ï¼Œå¯é…ç½® Network First / Cache First


é—®ï¼šä¸ºä»€ä¹ˆ Workbox é»˜è®¤ä¸ç¼“å­˜ POST è¯·æ±‚ï¼Ÿ
ç­”ï¼š
POST è¯·æ±‚å¸¦ bodyï¼ŒCache API key ä¸åŒ…å« bodyï¼Œç›¸åŒ URL ä¸åŒ body ä¼šå‘½ä¸­åŒä¸€æ¡ç¼“å­˜ â†’ æ•°æ®ä¸ä¸€è‡´
POST è¯·æ±‚éžå¹‚ç­‰ï¼Œç¼“å­˜å¯èƒ½å¯¼è‡´é€»è¾‘é”™è¯¯ (å¹‚ç­‰æŒ‡åŒä¸€ä¸ªæ“ä½œæ‰§è¡Œ ä¸€æ¬¡å’Œæ‰§è¡Œå¤šæ¬¡ï¼Œç»“æžœæ˜¯ä¸€æ ·çš„ã€‚è€Œpostæ¯æ¬¡è¯·æ±‚å¯èƒ½éƒ½ä¼šåˆ›å»ºæ–°çš„èµ„æºï¼ˆä¾‹å¦‚åˆ›å»ºè®¢å•ã€ç•™è¨€ã€è¯„è®ºï¼‰)
é—®ï¼šç¦»çº¿æ—¶ POST è¯·æ±‚å¦‚ä½•å¤„ç†ï¼Ÿ
ç­”ï¼š
åˆ©ç”¨ IndexedDB æž„å»ºç¦»çº¿é˜Ÿåˆ—ï¼Œç½‘ç»œæ¢å¤æ—¶é€šè¿‡ Background Sync æ‰¹é‡é‡æ”¾è¯·æ±‚ã€‚æ¯æ¡è¯·æ±‚ç”Ÿæˆå”¯ä¸€ IDï¼Œé˜²æ­¢é‡å¤æäº¤ï¼›å¤±è´¥è¯·æ±‚æœ‰é™é‡è¯•ï¼ˆå¦‚ 3 æ¬¡ï¼‰ï¼Œè¶…è¿‡æ¬¡æ•°ä¸¢å¼ƒå¹¶æç¤ºç”¨æˆ·ã€‚


é—®ï¼šå¤šæ ‡ç­¾é¡µåŒæ—¶å†™ç¦»çº¿é˜Ÿåˆ—å¦‚ä½•é¿å…å†²çªï¼Ÿ
ç­”ï¼š
åˆ©ç”¨ SW å•çº¿ç¨‹ç‰¹æ€§ï¼Œåœ¨ replay é˜¶æ®µåŠ é”ï¼Œä¿è¯åŒä¸€æ—¶åˆ»åªæ‰§è¡Œä¸€æ¬¡é‡æ”¾
IndexedDB å†™å…¥äº‹åŠ¡ + å”¯ä¸€ ID é¿å…é‡å¤
é‡æ”¾æ—¶æ£€æŸ¥ UUID åŽ»é‡

é™æ€èµ„æº hash ç®¡ç† + precache â†’ è‡ªåŠ¨æ›´æ–° SW
activate é˜¶æ®µæ¸…ç†æ—§ç¼“å­˜
runtime cache è®¾ç½®è¿‡æœŸç­–ç•¥ï¼Œé¿å…æ—§èµ„æºé˜»å¡žæ–°é¡µé¢
å‘ç‰ˆæœŸé—´ç¦»çº¿é˜Ÿåˆ— POST è¯·æ±‚ç‰ˆæœ¬å…¼å®¹å¤„ç†
å¯é€‰æç¤ºç”¨æˆ·åˆ·æ–° â†’ å¼ºåˆ¶æ›´æ–° SW


æ™®é€šå‘ç‰ˆèµ° SW é»˜è®¤æµç¨‹ï¼Œç”¨æˆ·ä¸‹æ¬¡è®¿é—®è‡ªåŠ¨æ›´æ–°
å…³é”®å‘ç‰ˆé€šè¿‡é¡µé¢ JS ç»™ waiting SW å‘é€ skipWaiting æ¶ˆæ¯ï¼Œè®© SW ç«‹å³ activate å¹¶æŽ¥ç®¡é¡µé¢
é¡µé¢ç›‘å¬ controllerchange äº‹ä»¶åˆ·æ–°é¡µé¢ï¼ŒåŒæ—¶å…¼å®¹ç¦»çº¿é˜Ÿåˆ—æ•°æ®
è¿™æ ·æ—¢ä¿è¯äº†å¹³æ»‘æ›´æ–°ï¼Œä¹Ÿèƒ½åœ¨ç´§æ€¥æƒ…å†µä¸‹å¼ºåˆ¶ç”¨æˆ·å‡çº§ã€‚

Q: æˆ‘æƒ³çŸ¥é“å‰ç«¯å‘ç‰ˆåŽï¼Œä½†ç”¨æˆ·é•¿æ—¶é—´ä¸æ›´æ–°é¡µé¢ï¼Œé‚£ä¹ˆservice worker èƒ½çŸ¥é“æœ‰æ–°ç‰ˆæœ¬å—
A: èƒ½çŸ¥é“ï¼Œä½†ä¸æ˜¯å®žæ—¶çš„ã€‚Service Worker æ˜¯å¦èƒ½å‘çŽ°æ–°ç‰ˆæœ¬ï¼Œå–å†³äºŽâ€œæµè§ˆå™¨æ˜¯å¦å†æ¬¡è§¦å‘äº† SW çš„æ›´æ–°æ£€æŸ¥â€
Service Worker æœ¬èº«æ˜¯æ— æ³•ä¸»åŠ¨æ„ŸçŸ¥å‰ç«¯å‘ç‰ˆçš„ï¼Œå®ƒçš„æ›´æ–°æ˜¯ç”±æµè§ˆå™¨åœ¨é¡µé¢ reloadã€æ–°é¡µé¢æ‰“å¼€æˆ–å‘¨æœŸæ€§æ£€æŸ¥æ—¶è§¦å‘çš„ã€‚
å¦‚æžœç”¨æˆ·é•¿æ—¶é—´ä¸åˆ·æ–°é¡µé¢ï¼Œæ—§çš„ Service Worker å’Œé¡µé¢ä»£ç ä¼šä¸€ç›´è¿è¡Œã€‚
åœ¨å®žé™…é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šåœ¨é¡µé¢å±‚é€šè¿‡ç‰ˆæœ¬æŽ¥å£æˆ–å¿ƒè·³æœºåˆ¶æ„ŸçŸ¥æ–°ç‰ˆæœ¬ï¼Œå†ç»“åˆ Service Worker çš„ updatefound / controllerchange äº‹ä»¶ï¼Œæç¤ºç”¨æˆ·åˆ·æ–°ï¼Œä»Žè€Œåœ¨ä¸æ‰“æ–­ç”¨æˆ·æ“ä½œçš„å‰æä¸‹å®Œæˆæ›´æ–°ã€‚

ç”Ÿå‘½å‘¨æœŸ install â†’ waiting â†’ activate â†’ controlling clients

Qï¼š ä½ ä»¬çº¿ä¸Šå‡ºè¿‡ PWA äº‹æ•…å—
Aï¼š æœ‰è¿‡ä¸€æ¬¡æ¯”è¾ƒå…¸åž‹çš„ PWA æ›´æ–°äº‹æ•…ï¼Œä¸»è¦å’Œ Service Worker çš„æ¿€æ´»æ—¶æœºæœ‰å…³ï¼Œ
ä¸è¿‡å½±å“èŒƒå›´å¯æŽ§ï¼Œä¹ŸæŽ¨åŠ¨äº†æˆ‘ä»¬åŽç»­å¯¹å‘ç‰ˆç­–ç•¥çš„æ”¹è¿›ã€‚
å½“æ—¶ä¸ºäº†è®©ç”¨æˆ·å°½å¿«ä½¿ç”¨åˆ°æ–°ç‰ˆæœ¬ï¼Œæˆ‘ä»¬åœ¨ Service Worker ä¸­é»˜è®¤å¼€å¯äº† skipWaitingï¼Œå¸Œæœ›æ–°ç‰ˆæœ¬å¯ä»¥ç«‹å³ç”Ÿæ•ˆã€‚
åœ¨ä¸ªåˆ«ç”¨æˆ·åœºæ™¯ä¸‹ï¼Œå‡ºçŽ°äº†é¡µé¢è¿˜åœ¨è¿è¡Œæ—§ä»£ç ï¼Œä½†è¯·æ±‚å·²ç»è¢«æ–° Service Worker æŽ¥ç®¡çš„æƒ…å†µï¼Œ
å¯¼è‡´æŽ¥å£æ•°æ®ç»“æž„ä¸ä¸€è‡´ï¼Œé¡µé¢å‡ºçŽ°å¼‚å¸¸ã€‚
è¿™ç±»é—®é¢˜æœ¬è´¨ä¸Šæ˜¯æ–° Service Worker åœ¨é¡µé¢æœªåˆ·æ–°æ—¶æå‰æŽ¥ç®¡è¯·æ±‚ï¼Œå¯¼è‡´è¿”å›žçš„æ•°æ®ç»“æž„å·²ç»æ˜¯æ–°ç‰ˆæœ¬ï¼Œjsè¿˜æ˜¯æ—§çš„ï¼Œä½†æ˜¯æŽ¥å£å¯èƒ½æ›´æ–°äº†æˆ–è€…åˆ é™¤äº†
ä½†é¡µé¢ä»£ç ä»æŒ‰æ—§é€»è¾‘è§£æžï¼Œä»Žè€Œå‡ºçŽ°æŽ¥å£é”™é…æˆ–çŠ¶æ€å¼‚å¸¸

Qï¼šPWA æ›´æ–°å®‰å…¨è®¾è®¡ Checklist
Aï¼š Service Worker æ›´æ–°ç­–ç•¥ï¼ˆæœ€æ ¸å¿ƒï¼‰
â›” ç¦æ­¢é¡¹
âŒ é»˜è®¤ä½¿ç”¨ skipWaiting
âŒ install åŽç«‹å³ clients.claim
âŒ æ— æ¡ä»¶å¼ºåˆ¶ reload é¡µé¢
âœ… æŽ¨èé¡¹
âœ” é»˜è®¤ ä¸ skipWaiting
âœ” ç­‰ç”¨æˆ· refresh åŽè‡ªç„¶æ¿€æ´»
âœ” æˆ–ç”±é¡µé¢ä¸»åŠ¨è§¦å‘å‡çº§ï¼ˆpostMessageï¼‰

å¿…é¡»æ»¡è¶³çš„åŽŸåˆ™
é¡µé¢ JS ç‰ˆæœ¬ â‰¡ Service Worker ç‰ˆæœ¬
å®žè·µæ–¹å¼

âœ” é¡µé¢å¯åŠ¨æ—¶è®°å½•å½“å‰ APP_VERSION
âœ” Service Worker ç¼“å­˜ä¸­å¸¦ version å‘½åç©ºé—´
âœ” activate é˜¶æ®µåªæ¸…ç†æ—§ç‰ˆæœ¬ç¼“å­˜
const CACHE_NAME = `app-cache-${VERSION}`

ä¸‰ã€æ›´æ–°æ„ŸçŸ¥ä¸Žç”¨æˆ·äº¤äº’ï¼ˆUX éžå¸¸é‡è¦ï¼‰
å¿…é¡»æœ‰
âœ” æ›´æ–°æ£€æµ‹æœºåˆ¶ï¼ˆupdatefound / controllerchangeï¼‰
âœ” æ˜Žç¡®çš„æ›´æ–°æç¤º UI
âœ” ç”¨æˆ·å¯é€‰æ‹©ã€Œç¨åŽ / ç«‹å³åˆ·æ–°ã€

ç¦æ­¢
âŒ æ— æç¤ºè‡ªåŠ¨åˆ·æ–°
âŒ é™é»˜å‡çº§å…³é”®é¡µé¢

æŽ¥å£ & æ•°æ®ç»“æž„å…¼å®¹æ€§
å¿…é¡»åšåˆ°
âœ” æŽ¥å£å­—æ®µ å‘åŽå…¼å®¹
âœ” æ–°å­—æ®µåªæ–°å¢žï¼Œä¸ç›´æŽ¥åˆ é™¤æ—§å­—æ®µ
âœ” å‰ç«¯å®¹é”™è§£æžï¼ˆoptional chainingï¼‰
res?.data?.name || res?.result?.username

é™æ€èµ„æº
âœ” Cache First
âœ” å¸¦ hash çš„æ–‡ä»¶å
âœ” æ–°ç‰ˆæœ¬ç¼“å­˜ä¸å¤ç”¨æ—§ key

Qï¼š åœ¨ Hybrid H5 åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬ä¸å…è®¸ Service Worker è‡ªè¡Œå‡çº§ï¼Œè€Œæ˜¯ç”±é¡µé¢ JS ç»Ÿä¸€æŽ§åˆ¶å‡çº§èŠ‚å¥ã€‚
é¡µé¢å’Œ Service Worker ä½¿ç”¨åŒä¸€ buildId æž„å»ºäº§ç‰©ï¼Œåœ¨ç¡®è®¤é¡µé¢åˆ·æ–°åŽæ‰è§¦å‘ SW æ¿€æ´»ï¼Œ
ä»Žè€Œä¿è¯é¡µé¢ JSã€Service Workerã€ç¼“å­˜å’Œ IndexedDB æ•°æ®ç»“æž„å§‹ç»ˆä¿æŒä¸€è‡´ï¼Œ
é¿å…å‘ç‰ˆè¿‡ç¨‹ä¸­å‡ºçŽ°æ–° SW æŽ¥ç®¡æ—§é¡µé¢å¯¼è‡´çš„çº¿ä¸Šäº‹æ•…ã€‚

æˆ‘ä»¬é€šè¿‡ CI ç»Ÿä¸€ç”Ÿæˆ buildIdï¼Œå¹¶å°†å…¶æ³¨å…¥é¡µé¢ JSã€Service Workerã€ç¼“å­˜ key å’Œ IndexedDB é˜Ÿåˆ—ã€‚
é¡µé¢å¯åŠ¨æ—¶é€šè¿‡ version.json åˆ¤æ–­æ˜¯å¦å‡çº§ï¼Œå¹¶åœ¨ç”¨æˆ·ç¡®è®¤åŽæ‰è§¦å‘ Service Worker æ¿€æ´»ï¼Œ
ä»Žè€Œä¿è¯ Hybrid åœºæ™¯ä¸‹é¡µé¢ä¸Ž Service Worker çš„ç‰ˆæœ¬å¼ºä¸€è‡´ï¼Œé¿å…å‘ç‰ˆäº‹æ•…ã€‚

Service Worker çš„ Cache Storage ä¸æ”¯æŒè‡ªåŠ¨æ·˜æ±°
æˆ‘ä»¬é€šè¿‡ LRU æŽ§åˆ¶ç¼“å­˜è§„æ¨¡ï¼Œé¿å…ç£ç›˜æ— é™å¢žé•¿
å®žçŽ°ä¸Šä½¿ç”¨ Workbox ExpirationPlugin
LRU å…ƒæ•°æ®å­˜ IndexedDBï¼ŒResponse å­˜ Cache Storage
é¦–é¡µèµ„æºå¼ºç¼“å­˜ï¼Œå­è·¯ç”±å’ŒæŽ¥å£å¼±ç¼“å­˜æˆ–ä¸ç¼“å­˜
ç§»åŠ¨ç«¯ä¼˜å…ˆé™åˆ¶å›¾ç‰‡ç¼“å­˜æ•°é‡

2ï¸âƒ£ é¦–é¡µ HTMLï¼šå¼ºç¼“å­˜ï¼ˆåªç¼“å­˜ /ï¼‰
registerRoute(
  ({ request, url }) =>
    request.mode === 'navigate' && url.pathname === '/',
  new CacheFirst({
    cacheName: 'html-home',
    plugins: [
      new ExpirationPlugin({
        maxEntries: 1,               // åªç¼“å­˜é¦–é¡µ
        maxAgeSeconds: 24 * 60 * 60  // 1 å¤©
      })
    ]
  })
)

3ï¸âƒ£äºŒçº§è·¯ç”± HTMLï¼šæ˜Žç¡®ä¸ç¼“å­˜
registerRoute(
  ({ request, url }) =>
    request.mode === 'navigate' && url.pathname !== '/',
  new NetworkOnly()
)

4ï¸âƒ£ JS / CSSï¼šSWR + LRU
registerRoute(
  ({ request }) =>
    request.destination === 'script' ||
    request.destination === 'style',
  new StaleWhileRevalidate({
    cacheName: 'static-assets',
    plugins: [
      new ExpirationPlugin({
        maxEntries: 30,
        maxAgeSeconds: 7 * 24 * 60 * 60
      })
    ]
  })
)

5ï¸âƒ£ å›¾ç‰‡èµ„æºï¼šCacheFirst + ä¸¥æ ¼ LRU
registerRoute(
  ({ request }) => request.destination === 'image',
  new CacheFirst({
    cacheName: 'image-cache',
    plugins: [
      new ExpirationPlugin({
        maxEntries: 50,               // iOS å»ºè®® â‰¤ 50
        maxAgeSeconds: 30 * 24 * 60 * 60
      })
    ]
  })
)

6ï¸âƒ£ æŽ¥å£è¯·æ±‚ï¼šæ…Žç”¨ç¼“å­˜
registerRoute(
  ({ url }) => url.pathname.startsWith('/api/'),
  new StaleWhileRevalidate({
    cacheName: 'api-cache',
    plugins: [
      new ExpirationPlugin({
        maxEntries: 10,
        maxAgeSeconds: 60
      })
    ]
  })
)

âŒ å‘ 1ï¼šiOS ä¼šâ€œæ‚„æ‚„æ¸…ç¼“å­˜â€
çŽ°è±¡ï¼š
Safari ç©ºé—´ä¸è¶³æ—¶
PWA é•¿æ—¶é—´åŽå°
ç³»ç»Ÿè‡ªåŠ¨æ¸… Cache Storage

é¦–é¡µ HTML æ°¸è¿œå¯èµ°ç½‘ç»œå…œåº•
ä¸ä¾èµ–ç¼“å­˜åšå”¯ä¸€æ•°æ®æº
CacheFirst + ç½‘ç»œ fallback

âŒ å‘ 3ï¼šç¼“å­˜è¿‡å¤šç›´æŽ¥ç™½å±
åŽŸå› ï¼š
å›¾ç‰‡ç¼“å­˜è¿‡å¤§
å¤šä¸ª CacheName
æœªé™åˆ¶ maxEntries

å›¾ç‰‡ç¼“å­˜ â‰¤ 50
HTML cache â‰¤ 1
åˆå¹¶ cacheName

âŒ å‘ 4ï¼šiOS ä¸è§¦å‘ SW æ›´æ–°
çŽ°è±¡ï¼š
æ–°ç‰ˆæœ¬å·²å‘å¸ƒ
ç”¨æˆ·ä»ç”¨æ—§ç¼“å­˜

self.skipWaiting()
clients.claim()


æˆ‘ä»¬åœ¨ Service Worker ä¸­åªç¼“å­˜é¦–é¡µ HTMLï¼Œ
äºŒçº§è·¯ç”±é¡µé¢å…¨éƒ¨èµ° NetworkOnlyï¼Œ
é¿å…ä¸šåŠ¡é¡µé¢è¿‡æœŸå’Œç™»å½•æ€é”™ä¹±ã€‚

é™æ€èµ„æºé‡‡ç”¨ Workbox çš„ LRU æŽ§åˆ¶ç¼“å­˜æ•°é‡ï¼Œ
å›¾ç‰‡ç¼“å­˜ä¸¥æ ¼é™åˆ¶åœ¨ 50 ä»¥å†…ï¼Œ
åŒæ—¶è€ƒè™‘ iOS Safari å¯¹ç¼“å­˜çš„æ¸…ç†æœºåˆ¶ï¼Œ
ä¸ä¾èµ–ç¼“å­˜ä½œä¸ºå”¯ä¸€æ•°æ®æ¥æºã€‚

äºŒçº§è·¯ç”± 
registerRoute(
  ({ request }) => request.mode === 'navigate',
  new CacheFirst() => new NetworkOnly()
)
å†™æŽ¥å£ï¼šæ°¸è¿œä¸ç¼“å­˜


äº”ã€ä¸€ä¸ªâ€œç†æƒ³æŠ˜ä¸­æ–¹æ¡ˆâ€ï¼ˆä½ ä»¬è¿™ç§é¡¹ç›®å¾ˆé€‚åˆï¼‰

æŽ¥ Service Workerï¼Œä½†åªç”¨ 30% èƒ½åŠ›

ç­–ç•¥ï¼š
âœ… åªç¼“å­˜é¦–é¡µ HTML
âœ… JS / CSS / å›¾ç‰‡ç”¨ LRU
âŒ äºŒçº§è·¯ç”±ä¸ç¼“å­˜
âŒ æŽ¥å£é»˜è®¤ä¸ç¼“å­˜
âœ… iOS ä¸“å±žé™çº§
âœ… ä¸€é”®å…³é—­ SW
ðŸ‘‰ æ”¶ç›Šæœ€å¤§ï¼Œé£Žé™©å¯æŽ§

ç§»åŠ¨ç«¯ H5 å¼•å…¥ Service Worker ä¸»è¦æ˜¯ä¸ºäº†æå‡é¦–å±æ€§èƒ½å’Œå¼±ç½‘ä½“éªŒï¼Œ
ä½†å®ƒå¹¶ä¸æ˜¯ä¸€ä¸ªâ€œå¿…é€‰é¡¹â€ã€‚

æˆ‘ä»¬åœ¨å®žé™…é¡¹ç›®ä¸­åªä½¿ç”¨å®ƒçš„éƒ¨åˆ†èƒ½åŠ›ï¼Œ
æ¯”å¦‚ç¼“å­˜é¦–é¡µ HTML å’Œé™æ€èµ„æºï¼Œ
åŒæ—¶ä¸¥æ ¼ç¦æ­¢ç¼“å­˜ä¸šåŠ¡é¡µé¢å’Œå†™æŽ¥å£ï¼Œ
å¹¶ä¸”é’ˆå¯¹ iOS Safari åšäº†é™çº§å¤„ç†ï¼Œ
ä»¥é¿å…ç¼“å­˜å¯¼è‡´çš„æ•°æ®ä¸€è‡´æ€§å’Œçº¿ä¸Šäº‹æ•…ã€‚


ï¼ï¼ï¼ï¼ï¼ï¼

åœ¨ç§»åŠ¨ç«¯ H5 é¡¹ç›®é‡Œï¼Œæˆ‘ä»¬å¼•å…¥äº† Service Workerï¼Œ
ä½†å¹¶æ²¡æœ‰é€‰æ‹©å…¨é‡ç¼“å­˜ï¼Œè€Œæ˜¯åšäº†ä¸€å¥—åˆ†å±‚ç¼“å­˜ç­–ç•¥ã€‚

å…·ä½“æ¥è¯´ï¼Œæˆ‘ä»¬åªç¼“å­˜é¦–é¡µ HTML å’Œé™æ€èµ„æºï¼Œ
é¦–é¡µç”¨çš„æ˜¯ Cache Firstï¼Œ
JSã€CSSã€å›¾ç‰‡èµ°çš„æ˜¯ Stale-While-Revalidateï¼Œå¹¶ä¸”é…åˆ LRU æŽ§åˆ¶ç¼“å­˜æ•°é‡ã€‚

æ‰€æœ‰äºŒçº§è·¯ç”±é¡µé¢å’Œä¸šåŠ¡æŽ¥å£ï¼Œå°¤å…¶æ˜¯ä¸‹å•ã€ç™»å½•è¿™ç±»å†™æŽ¥å£ï¼Œ
éƒ½æ˜¯æ˜Žç¡®ç¦æ­¢ç¼“å­˜çš„ï¼Œç»Ÿä¸€èµ° Network Onlyã€‚

è¿™ä¹ˆåšçš„åŽŸå› ä¸»è¦æ˜¯ï¼š
HTML å’ŒæŽ¥å£ä¸€æ—¦ç¼“å­˜ï¼Œå¾ˆå®¹æ˜“åœ¨ç‰ˆæœ¬å‡çº§æˆ–è€…å¼±ç½‘åœºæ™¯ä¸‹ï¼Œ
å‡ºçŽ°æ•°æ®ä¸ä¸€è‡´ç”šè‡³ä¸šåŠ¡äº‹æ•…ã€‚

å®žé™…ä¸Šæˆ‘ä»¬ä¸Šçº¿æ—©æœŸç¡®å®žé‡åˆ°è¿‡é—®é¢˜ï¼Œ
æœ‰ä¸€æ¬¡å› ä¸ºæŽ¥å£ä½¿ç”¨äº† SWR ç­–ç•¥ï¼Œ
åœ¨å¼±ç½‘ä¸‹ Service Worker è¿”å›žäº†æ—§çš„æˆåŠŸå“åº”ï¼Œ
å‰ç«¯æ˜¾ç¤ºä¸‹å•æˆåŠŸï¼Œä½†åŽå°å¹¶æ²¡æœ‰çœŸæ­£åˆ›å»ºè®¢å•ã€‚
è¿”å›žè®¢å•åˆ—è¡¨é¡µåŽï¼Œæ²¡æœ‰æ–°çš„è®¢å•åˆ—è¡¨ï¼Œå› ä¸ºèµ°çš„ç¼“å­˜æŽ¥å£ï¼Œæ‹¿åˆ°çš„æ˜¯æ—§å“åº”
ä½†æ˜¯ç”¨æˆ·ä¸‹å•åŽåˆ·æ–°é¡µé¢è¯´æ²¡æœ‰çœŸå®žè®¢å•ï¼Œ
ä½†å…¶å®žæ˜¯æˆ‘ä»¬æ‹¿ç¼“å­˜æŽ¥å£çš„åŽŸå› å¯¼è‡´çš„



Q1ï¼šä¸ºä»€ä¹ˆä¸å…¨ç¼“å­˜ï¼Ÿæ˜¯ä¸æ˜¯å¤ªä¿å®ˆäº†ï¼Ÿ
ä¸»è¦æ˜¯å› ä¸ºç¼“å­˜æ˜¯ä¸å¯é€†çš„ï¼Œä¸€æ—¦ä¸‹å‘åˆ°ç”¨æˆ·ç«¯ï¼Œ
å›žæ»šæˆæœ¬éžå¸¸é«˜ã€‚
æ€§èƒ½é—®é¢˜å¯ä»¥é€æ­¥ä¼˜åŒ–ï¼Œä½†ä¸šåŠ¡äº‹æ•…çš„é£Žé™©æ˜¯ä¸€æ¬¡å°±ä¸å¯æŽ¥å—çš„ï¼Œ
æ‰€ä»¥æˆ‘ä»¬åªç¼“å­˜ç¡®å®šæ€§èµ„æºã€‚

Q2ï¼šå½“æ—¶ä¸ºä»€ä¹ˆä¼šç¼“å­˜æŽ¥å£ï¼Ÿ
æœ€åˆæ˜¯æƒ³åœ¨å¼±ç½‘ä¸‹æå‡åˆ—è¡¨ç±»æŽ¥å£çš„ä½“éªŒï¼Œ
ä½†å½“æ—¶æ²¡æœ‰ä¸¥æ ¼åŒºåˆ†è¯»å†™æŽ¥å£ï¼Œ
è¿™æ˜¯è®¾è®¡ä¸Šçš„ä¸€ä¸ªé—®é¢˜ã€‚

Q3ï¼šä½ ä»¬æ˜¯æ€Žä¹ˆå‘çŽ°è¿™ä¸ªé—®é¢˜çš„ï¼Ÿ
ä¸»è¦æ˜¯çº¿ä¸Šç”¨æˆ·åé¦ˆè¯´åˆ·æ–°åŽé¡µé¢æ‰æ­£å¸¸


Q4ï¼šä½ ä»¬æœ€ç»ˆæ˜¯æ€Žä¹ˆè§£å†³çš„ï¼Ÿ
åˆ†ä¸‰æ­¥ï¼š
ç¬¬ä¸€ï¼Œç´§æ€¥ç¦ç”¨æ‰€æœ‰æŽ¥å£ç¼“å­˜æ­¢è¡€ï¼›
ç¬¬äºŒï¼ŒæŽ¥å£æŒ‰è¯»å†™é‡æ–°åˆ†çº§ï¼Œå†™æŽ¥å£å…¨éƒ¨ Network Onlyï¼›
ç¬¬ä¸‰ï¼Œä¸‹å•é“¾è·¯å¢žåŠ çŠ¶æ€ç¡®è®¤å’ŒåŽç«¯å¹‚ç­‰æ ¡éªŒï¼Œ
ç¡®ä¿å³ä½¿å‰ç«¯å¼‚å¸¸ä¹Ÿä¸ä¼šå‡ºé”™ã€‚

Q5ï¼šiOS Safari æœ‰ç‰¹æ®Šå¤„ç†å—ï¼Ÿ
æœ‰çš„ã€‚
iOS å¯¹ Service Worker å’Œç¼“å­˜çš„è¡Œä¸ºæ¯”è¾ƒä¿å®ˆï¼Œ
æ‰€ä»¥åœ¨ iOS ä¸Šæˆ‘ä»¬ç­–ç•¥æ›´ä¸¥æ ¼ï¼Œ
æ¯”å¦‚å›¾ç‰‡ç¼“å­˜æ•°é‡æ›´å°ï¼ŒæŽ¥å£å…¨éƒ¨èµ°ç½‘ç»œã€‚

åŽæ¥æˆ‘ä»¬ç¬¬ä¸€æ—¶é—´æ­¢è¡€ï¼Œ
ç¦ç”¨äº†æ‰€æœ‰æŽ¥å£ç¼“å­˜ï¼Œ
å¹¶ä¸”é‡æž„äº†ç­–ç•¥ï¼Œåªå…è®¸ç¼“å­˜å¹‚ç­‰çš„ GET æ•°æ®æŽ¥å£ï¼Œ
åŒæ—¶åœ¨ä¸‹å•é“¾è·¯ä¸Šå¢žåŠ äº†äºŒæ¬¡çŠ¶æ€ç¡®è®¤ã€‚

æœ€ç»ˆè¿™å¥—ç­–ç•¥åœ¨æ€§èƒ½å’Œç¨³å®šæ€§ä¹‹é—´å–å¾—äº†æ¯”è¾ƒå¥½çš„å¹³è¡¡ï¼Œ
é¦–å±æ—¶é—´æœ‰æ˜Žæ˜¾æ”¹å–„ï¼Œä½†æ²¡æœ‰å†å‡ºçŽ°è¿‡ç¼“å­˜å¼•å‘çš„ä¸šåŠ¡é—®é¢˜ã€‚


åœ¨ç§»åŠ¨ç«¯ H5 é¡¹ç›®é‡Œï¼Œæˆ‘ä»¬å¼•å…¥äº† Service Workerï¼Œ
ä½†å¹¶æ²¡æœ‰é€‰æ‹©å…¨é‡ç¼“å­˜ï¼Œè€Œæ˜¯åšäº†ä¸€å¥—åˆ†å±‚ç¼“å­˜ç­–ç•¥ã€‚

å…·ä½“æ¥è¯´ï¼Œæˆ‘ä»¬åªç¼“å­˜é¦–é¡µ HTML å’Œé™æ€èµ„æºï¼Œ
é¦–é¡µç”¨çš„æ˜¯ Cache Firstï¼Œ
JSã€CSSã€å›¾ç‰‡èµ°çš„æ˜¯ Stale-While-Revalidateï¼Œå¹¶ä¸”é…åˆ LRU æŽ§åˆ¶ç¼“å­˜æ•°é‡ã€‚

æ‰€æœ‰äºŒçº§è·¯ç”±é¡µé¢å’Œä¸šåŠ¡æŽ¥å£ï¼Œå°¤å…¶æ˜¯ä¸‹å•ã€ç™»å½•è¿™ç±»å†™æŽ¥å£ï¼Œ
éƒ½æ˜¯æ˜Žç¡®ç¦æ­¢ç¼“å­˜çš„ï¼Œç»Ÿä¸€èµ° Network Onlyã€‚

è¿™ä¹ˆåšçš„åŽŸå› ä¸»è¦æ˜¯ï¼š
HTML å’ŒæŽ¥å£ä¸€æ—¦ç¼“å­˜ï¼Œå¾ˆå®¹æ˜“åœ¨ç‰ˆæœ¬å‡çº§æˆ–è€…å¼±ç½‘åœºæ™¯ä¸‹ï¼Œ
å‡ºçŽ°æ•°æ®ä¸ä¸€è‡´ç”šè‡³ä¸šåŠ¡äº‹æ•…ã€‚

å®žé™…ä¸Šæˆ‘ä»¬ä¸Šçº¿æ—©æœŸç¡®å®žé‡åˆ°è¿‡é—®é¢˜ï¼Œ
æœ‰ä¸€æ¬¡å› ä¸ºæŽ¥å£ä½¿ç”¨äº† SWR ç­–ç•¥ï¼Œ
åœ¨å¼±ç½‘ä¸‹ Service Worker è¿”å›žäº†æ—§çš„æˆåŠŸå“åº”ï¼Œ
å‰ç«¯æ˜¾ç¤ºä¸‹å•æˆåŠŸï¼Œä½†åŽå°å¹¶æ²¡æœ‰çœŸæ­£åˆ›å»ºè®¢å•ã€‚

åŽæ¥æˆ‘ä»¬ç¬¬ä¸€æ—¶é—´æ­¢è¡€ï¼Œ
ç¦ç”¨äº†æ‰€æœ‰æŽ¥å£ç¼“å­˜ï¼Œ
å¹¶ä¸”é‡æž„äº†ç­–ç•¥ï¼Œåªå…è®¸ç¼“å­˜å¹‚ç­‰çš„ GET æ•°æ®æŽ¥å£ï¼Œ
åŒæ—¶åœ¨ä¸‹å•é“¾è·¯ä¸Šå¢žåŠ äº†äºŒæ¬¡çŠ¶æ€ç¡®è®¤ã€‚

æœ€ç»ˆè¿™å¥—ç­–ç•¥åœ¨æ€§èƒ½å’Œç¨³å®šæ€§ä¹‹é—´å–å¾—äº†æ¯”è¾ƒå¥½çš„å¹³è¡¡ï¼Œ
é¦–å±æ—¶é—´æœ‰æ˜Žæ˜¾æ”¹å–„ï¼Œä½†æ²¡æœ‰å†å‡ºçŽ°è¿‡ç¼“å­˜å¼•å‘çš„ä¸šåŠ¡é—®é¢˜ã€‚

Service Worker åŠ å…¥åŽï¼Œèƒ½å¤Ÿç¼“å­˜é¦–é¡µ HTMLã€JSã€CSSã€å›¾ç‰‡ï¼Œ
è®©ç”¨æˆ·åœ¨äºŒæ¬¡è®¿é—®æˆ–è€…å¼±ç½‘çŽ¯å¢ƒä¸‹ï¼ŒWebView å¯ä»¥å¿«é€Ÿæ¸²æŸ“é¦–å±ï¼Œ
å¤§å¹…å‡å°‘å› ä¸ºç½‘ç»œæ…¢å¯¼è‡´çš„ç™½å±

registerRoute(
  ({ request, url }) =>
    request.mode === 'navigate' &&
    url.pathname !== '/',

  async ({ request }) => {
    return fetch(request); // æ°¸è¿œç›´è¿žç½‘ç»œ
  }
);